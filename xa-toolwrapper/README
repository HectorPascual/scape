Tool Wrapper v0.2
=================

Quick start
-----------

You need at least the Java SE Development Kit (JDK) version >=1.6.0 and Apache
Maven >= 2.2.1. Also make sure the JAVA_HOME environment variable is defined.

1) In the xa-toolwrapper directory, run the project generator with the default
   arguments:

       java -jar toolwrapper.jar

   This will generate an example project generated/simplecopy10. This service is
   a an example wrapper project for the linux copy command "cp" or the COPY
   command for Windows (use "CMD.exe /C COPY" instead of "cp" in the command
   pattern defined by the property service.operation.1.clicmd in the project 
   property file default.properties if you are using windows).

2) Start your Apache Tomcat server:

       cd <tomcat-install>/bin
       ./startup.sh

   where <tomcat-install> is the directory where the Apache Tomcat server is
   installed.

3) Change to the directory where the sample project has been generated:

       cd xa-toolwrapper/generated/simplecopy10

3) In order to deploy the web application archive (war), make sure

   a) the tomcat manager webapp is enabled (configure in Apache Tomcat's user
      configuration file conf/tomcat-users.xml) by defining a user, e.g.

      <tomcat-users>
        <role rolename="tomcat"/>
        <role rolename="manager"/>
        <user password="<password>" roles="tomcat,manager" username="tomcat"/>
      </tomcat-users>

   b) that user and password of the tomcat manager are defined in the project 
      properties (e.g. default.properties):

        tomcat.public.manager.user=tomcat
        tomcat.public.manager.pwd=<password>

   where <password> is the password that is defined for the Apache Tomcat manager
   user, and then deploy the example service:

       mvn tomcat:deploy

   In case of success, the web application archive
   generated/simplecopy10/target/scape-simplecopy10-service-0.2-SNAPSHOT.war
   will be deployed to

       http://localhost:8080/scape-simplecopy10-service

   Alternatively, the web application archive can be installed:

       mvn install

   and deployed manually afterwards.

   Note that if the application is already deployed, you must use 

       cd generated/simplecopy10
       mvn tomcat:redeploy

   otherwise you will get an error:

     Cannot invoke Tomcat manager: FAIL - Application already exists at path
     /scape-simplecopy10-service

4) Accessing the Axis2 service:

   You can find the start page of the web application at:

       http://localhost:8080/scape-simplecopy10-service/

   and the endpoint of the service at:

       http://localhost:8080/scape-simplecopy10-service/services/SimpleCopy10

   Try the RESTless interface:

       http://localhost:8080/scape-simplecopy10-service/services/SimpleCopy10/simpleCopy?inputUrl=http://localhost:8080/scape/testdata/scape-logo.png
 
   and - if everything is setup correctly - you would receive a response like:

   <ns:simpleCopyResponse>
       <ns:return>
           <tns:result>
               <tns:success>true</tns:success>
               <tns:returncode>0</tns:returncode>
               <tns:message>Service request has been processed successfully</tns:message>
               <tns:time>0</tns:time>
               <tns:unitid>http://fue.onb.ac.at/scape/fue-l/tomcat1</tns:unitid>
               <tns:log>========= PROCESSING REQUEST =========.
               Using service: SCAPESimpleCopy10Service.
               Parameter processingUnit from services.xml: http://fue.onb.ac.at/scape/fue-l/tomcat1.
               URL of input file: http://fue.onb.ac.at/scape/testdata/test.tiff.
               Service request has been processed successfully.
               </tns:log>
               <tns:outputFile>http://localhost:8080/scape/tmp/scape-logo-1023892389923.png</tns:outputFile>
           </tns:result>
       </ns:return>
   </ns:simpleCopyResponse>

  The service simply has copied the file available at the URL http://localhost:8080/scape/testdata/scape-logo.png
  to a new location and made available by a new URL http://localhost:8080/scape/tmp/scape-logo-1023892389923.png.

5) Try using the web service using soapUI by creating a project using the
   WSDL of the service:

       http://localhost:8080/scape-simplecopy10-service/SimpleCopy10.wsdl

   make a file available on a publicly accessible URL, e.g. by placing the
   a sample file scape-logo.png in the webapps/ROOT/scape/tesdata/ folder
   of your apache tomcat:

       http://localhost:8080/scape/testdata/scape-logo.png

   And then execute a soap request:

   <soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:ser="http://scape-project.eu/pc/services">
       <soap:Header/>
       <soap:Body>
          <ser:Request1>
             <ser:input>http://localhost:8080/scape/testdata/scape-logo.png</ser:input>
          </ser:Request1>
       </soap:Body>
    </soap:Envelope>

   You would then receive a response containing a reference to the copied result
   file, like:

   <soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope">
       <soapenv:Body>
          <ns:simpleCopyResponse xmlns:ns="http://scape-project.eu/pc/services">
             <ns:return>
                <tns:result xmlns:tns="http://scape-project.eu/pc/services">
                   <tns:success>true</tns:success>
                   <tns:returncode>0</tns:returncode>
                   <tns:time>22</tns:time>
                   <tns:log>========= PROCESSING REQUEST =========.
                    Using service: SimpleCopy10.
                    URL of input file: http://localhost:8080/scape/testdata/scape-logo.png.
                    Input file created: /usr/local/java/apache-tomcat-6.0.29/temp/simplecopy10-tmp-store/fromurl2399759179719296814.png.
                    Pattern (before substitution): cp $INFILE $OUTFILE.
                    OUTFILE substitution variable value: /usr/local/java/apache-tomcat-6.0.29/temp/simplecopy10-tmp-store/fromurl2399759179719296814.pngSCAPESimpleCopy10Service_outputFile_8185195208001481281.png.
                    INFILE substitution variable value: /usr/local/java/apache-tomcat-6.0.29/temp/simplecopy10-tmp-store/fromurl2399759179719296814.png.
                    Command (after substitution): cp /usr/local/java/apache-tomcat-6.0.29/temp/simplecopy10-tmp-store/fromurl2399759179719296814.png /usr/local/java/apache-tomcat-6.0.29/temp/simplecopy10-tmp-store/fromurl2399759179719296814.pngSCAPESimpleCopy10Service_outputFile_8185195208001481281.png.
                    Assigned exit code: 0.
                    Process finished successfully with code 0.
                    Output file of size 24805 has been created successfully.
                    Public output file: /usr/local/java/apache-tomcat-6.0.29/webapps/ROOT/scape/tmp/fromurl2399759179719296814.pngSCAPESimpleCopy10Service_outputFile_8185195208001481281.png.
                    Output URL: http://localhost:8080/scape/tmp/fromurl2399759179719296814.pngSCAPESimpleCopy10Service_outputFile_8185195208001481281.png.
                    Service request has been processed successfully.</tns:log>
                   <tns:message>Service request has been processed successfully</tns:message>
                   <tns:output>http://localhost:8080/scape/tmp/fromurl2399759179719296814.pngSCAPESimpleCopy10Service_outputFile_8185195208001481281.png</tns:output>
                </tns:result>
             </ns:return>
          </ns:simpleCopyResponse>
       </soapenv:Body>
    </soapenv:Envelope>

Create a new project
--------------------

1) Configure the project by creating configuration files:

   a) default.properties
      Project configuration file defining name of the project context,
      name of the tool the web service provides access to, server
      parameters for deploying the service, etc. The server settings in the
      default.properties file correspond to the deployment environment that
      is included.

   b) default_inputconfig.json and default_outputconfig.json
      Input and output data type configuration files, see also other example files
      *_inputconfig.json and *_outputconfig.json available in the root folder.
      The following properties can be defined for each variable:
      - Datatype - one of xsd:anyURI, xsd:string, xsd:boolean, xsd:int (required)
      - Restriction - An array of allowed values, e.g. ["One","Two","Three"] (optional)
      - CliMapping - Mapping to command line pattern variable, see property
            service.operation.1.clicmd in default.properties
      - ServiceResult - Some variables are provided by the service and can be
            mapped to an output port (data types have to be the same):
            - processing_success (boolean) - success/failure of service execution
            - processing_returncode (int) - 0 for success >0 if an error occurred
            - processing_message (String)  - service execution message
            - processing_log (String) - service execution log
            - processing_time (int) - processing time in milliseconds
            - processing_unitid (String) - Processing unit identifier
      - Default - Default value if using an array of allowed values, see property
            "Restriction" above (optional)
      - Cardinality - Use "list" for a string list input, the property
            defaults to "single" if omitted.
      - Documentation - Documentation for the variable
      - PrefixFromInput - Only for file outputs (xsd:anyURI): Indicate the input
            file variable which should be used as a prefix for the output filename.

   See the "examples" folder which contains more configuration files.

2) Run the project generator (default arguments):

       java -jar toolwrapper.jar

   or indicating the configuration files to be used:

       java -jar toolwrapper.jar -pc default.properties -ic default_inputconfig.json -oc default_outputconfig.json [-ic default_inputconfig2.json -oc default_outputconfig2.json ...]

   where:

       -pc specifies the file that contains the project configuration
       -ic specifies the file that contains the configuration of the input ports
       -oc specifies the file that contains the configuration of the output ports

   It is possible to define multiple operations, in this case multiple command
   line interface commands are defined in the project configuration, for example:

       service.operation.1=simplyCopy
       service.operation.1.description=Copy a source file to a target file
       service.operation.1.clicmd=cp @INFILE@ @OUTFILE@
       service.operation.2=verboseCopy
       service.operation.2.description=Copy a directorya source file to a target file
       service.operation.2.clicmd=cp @INFILE@ @OUTFILE@ --verbose

   and for each operation one input and one output configuration file is defined:

       java -jar toolwrapper.jar -pc default.properties -ic inputconfig_operation1.json -oc outputconfig_operation1.json -ic inputconfig_operation2.json -oc outputconfig_operation2.json

   The project will be created in the "generated" folder, the name of the project
   folder being derived from the project.title property defined in the project
   configuration.

3) Follow the README file of the generated project

Project structure
-----------------

- tmpl
  Code templates used for code insertion.

- examples
  Example configuration files.

- generated
  Folder where the generated SOAP web service wrapper projects will be stored.

- src
  Java sources of the Tool Wrapper

- target
  Build files

- template
  Project template (substitution variables in the template files)

- toolwrapper.jar
  Java binary executable (execute "java -jar toolwrapper.jar")

- default.properties
  Project configuration file

- default_inputconfig.json
  Input data types configuration file

- LICENSE
  Apache 2 license

- default_outputconfig.json
  Output data types configuration file

- pom.xml
  Maven file

- README
  This file

Requirements
------------

In order to build and run the web service, you will need the Java SE
Development Kit (JDK) version >=1.6.0, the underlying command line tool
installed on the deployment server (no white spaces in the path!) and an
Apache Tomcat version >=6.0.18 or equivalent servlet container with the Axis2
version >=1.4.1 web application deployed. Apache Ant version >= 1.8.0 is
required to build and deploy the web service. See section "Requirements" for
further information.

If you want to create a web service for an existing command line application
using this java based tool web service wrapper, the following software is
required:

- Underlying command line tool of this web service wrapper installed in a path
  without white spaces.
  Install the underlying command line tool of the tool web service wrapper
  on your system.
  IMPORTANT: THE UNDERLYING COMMAND LINE TOOL FOR THE SERVICE SHOULD BE 
  INSTALLED IN A PATH WITHOUT WHITE SPACES. OTHERWISE A FULL PATH CALL OF THE
  COMMAND LINE TOOL WILL NOT WORK CORRECTLY. 

- Java SE Development Kit (JDK), JDK 6 Update 12 or higher
  Please download the Java SE SDK for your system at
  http://java.sun.com/javaee/downloads/.

- Apache Tomcat server Version 6.0.18 or higher
  Please download and install the Apache Tomcat Server 6.0.18 here
  http://tomcat.apache.org/download-60.cgi and follow the instructions
  of the RUNNING.txt in your apache tomcat directory. There you will also find
  the information on how to configure and start the apache tomcat server.

Securing the Web Service
------------------------

The simpliest way to secure the web service is by configuring basic
HTTP-Authentication which can be done either in the tomcat application server
or any web server which you are using as frontend server.

Using the Apache2 webserver as frontend, you can configure the
HTTP-Authentication as follows (example for Linux):

1) Create a password file for a new user
       htpasswd -c /usr/local/apache2/pwds newuser
2) Configure access restriction in your httpd.conf, e.g. in
       /usr/local/apache2/httpd.conf
  restricting the access to the axis2 location (depends on the path):
    <Location /axis2>
        AuthName "only for registered users"
        AuthType Basic
        AuthUserFile "/usr/local/apache2/pwds"
        <Limit GET>
            require valid-user
        </Limit>
    </Location>

Also in the Apache Tomcat web server you can secure the web service
via basic HTTP-Authentication (example for Linux):

1) Configure the web.xml of the axis2 web application:
      /usr/local/java/apache-tomcat-6.0.18/webapps/axis2/WEB-INF/web.xml
    and add the following:
      <web-app>
        <security-constraint>
          <web-resource-collection>
              <web-resource-name>secured services</web-resource-name>
              <url-pattern>/services/*</url-pattern>
          </web-resource-collection>
          <auth-constraint>
              <role-name>webservice</role-name>
          </auth-constraint>
        </security-constraint>
        <login-config>
          <auth-method>BASIC</auth-method>
          <realm-name>webservice</realm-name>
        </login-config>
     </web-app>

2) This requires the user "webservice" to be defined in the tomcat-users.xml:
       /usr/local/java/apache-tomcat-6.0.18/conf/tomcat-users.xml
    as follows:
       <?xml version="1.0" encoding="utf-8">
       <tomcat-users>
           <role rolename="webservice"/>
           <user username="tomcat" password="somepassword" roles="webservice"/>
       </tomcat-users>
